<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Code Quest: Levels 9-10 - Final Projects & Portfolio</title>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #1e1e2f 0%, #2d1b69 20%, #00ffff 40%, #ffd700 100%);
      color: #fff;
      margin: 0;
      padding: 0;
      text-align: center;
      min-height: 100vh;
    }
    
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }
    
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 2s infinite alternate;
    }
    
    @keyframes twinkle {
      0% { opacity: 0.3; }
      100% { opacity: 1; }
    }
    
    .game-container {
      position: relative;
      z-index: 10;
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .hud {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(41, 41, 72, 0.95);
      backdrop-filter: blur(15px);
      padding: 20px 25px;
      border-radius: 20px;
      border: 2px solid #ffd700;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 10px 40px rgba(255, 215, 0, 0.3);
      min-width: 280px;
      text-align: left;
    }
    
    .progress-bar {
      width: 200px;
      height: 12px;
      background: #333;
      border-radius: 6px;
      margin: 8px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ffff, #ffd700);
      transition: width 0.8s ease;
      border-radius: 6px;
    }
    
    .hearts-display {
      display: flex;
      gap: 5px;
      margin: 10px 0;
    }
    
    .heart {
      font-size: 1.5em;
      transition: all 0.3s ease;
    }
    
    .heart.lost {
      opacity: 0.3;
      filter: grayscale(100%);
    }
    
    header {
      text-align: center;
      background: rgba(21, 21, 43, 0.8);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(255, 215, 0, 0.3);
    }
    
    .level-selector {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .level-card {
      background: rgba(41, 41, 72, 0.8);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #444;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    .level-card:hover {
      border-color: #ffd700;
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
    }
    
    .level-card.active {
      border-color: #ffd700;
      background: rgba(255, 215, 0, 0.1);
    }
    
    .level-card.completed {
      border-color: #00ff00;
      background: rgba(0, 255, 0, 0.1);
    }
    
    .quiz-container {
      background: rgba(41, 41, 72, 0.9);
      backdrop-filter: blur(15px);
      margin: 20px 0;
      padding: 40px;
      border-radius: 25px;
      border: 2px solid #ffd700;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
      max-width: 800px;
      margin: 20px auto;
    }
    
    .question-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .question-number {
      background: rgba(255, 215, 0, 0.2);
      color: #ffd700;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      margin-bottom: 15px;
      display: inline-block;
    }
    
    .question-text {
      font-size: 1.4em;
      margin-bottom: 30px;
      line-height: 1.5;
    }
    
    .question-options {
      display: grid;
      gap: 15px;
      margin: 30px 0;
    }
    
    .option-button {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #444;
      color: white;
      padding: 20px;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: left;
      font-size: 1.1em;
      position: relative;
    }
    
    .option-button:hover {
      border-color: #ffd700;
      background: rgba(255, 215, 0, 0.1);
      transform: translateY(-2px);
    }
    
    .option-button.selected {
      border-color: #ffd700;
      background: rgba(255, 215, 0, 0.2);
    }
    
    .option-button.correct {
      border-color: #00ff00;
      background: rgba(0, 255, 0, 0.2);
    }
    
    .option-button.incorrect {
      border-color: #ff4444;
      background: rgba(255, 68, 68, 0.2);
    }
    
    .option-button.disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }
    
    .code-question {
      background: #1e1e1e;
      border: 2px solid #444;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      color: #d4d4d4;
      font-size: 1.1em;
      line-height: 1.6;
    }
    
    .code-input {
      width: 100%;
      background: #1e1e1e;
      border: 2px solid #444;
      border-radius: 15px;
      padding: 20px;
      font-family: 'Courier New', monospace;
      color: #d4d4d4;
      font-size: 1.1em;
      resize: vertical;
      min-height: 150px;
      transition: border-color 0.3s ease;
    }
    
    .code-input:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
    }
    
    .button {
      padding: 15px 30px;
      margin: 10px;
      background: linear-gradient(45deg, #ffd700, #00ffff);
      color: #000;
      font-weight: bold;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1em;
    }
    
    .button:hover {
      background: linear-gradient(45deg, #00ffff, #ffd700);
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
    }
    
    .button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .feedback-container {
      margin: 20px 0;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      font-size: 1.1em;
    }
    
    .feedback-correct {
      background: rgba(0, 255, 0, 0.2);
      border: 2px solid #00ff00;
      color: #00ff00;
    }
    
    .feedback-incorrect {
      background: rgba(255, 68, 68, 0.2);
      border: 2px solid #ff4444;
      color: #ff4444;
    }
    
    .explanation {
      margin-top: 15px;
      font-size: 0.95em;
      opacity: 0.9;
      line-height: 1.5;
    }
    
    .lesson-complete {
      text-align: center;
      padding: 40px;
      background: linear-gradient(135deg, rgba(0, 255, 0, 0.1), rgba(255, 215, 0, 0.1));
      border: 2px solid #00ff00;
      border-radius: 20px;
      margin: 30px 0;
    }
    
    .stats-display {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .stat-card {
      background: rgba(0, 0, 0, 0.3);
      padding: 15px;
      border-radius: 12px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 1.8em;
      font-weight: bold;
      color: #ffd700;
    }
    
    .stat-label {
      font-size: 0.9em;
      opacity: 0.8;
      margin-top: 5px;
    }
    
    .graduation-ceremony {
      text-align: center;
      padding: 50px;
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(0, 255, 255, 0.2));
      border: 3px solid #ffd700;
      border-radius: 25px;
      margin: 30px 0;
      animation: celebrate 2s ease-in-out infinite alternate;
    }
    
    @keyframes celebrate {
      0% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
      100% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
    }
    
    .hidden {
      display: none;
    }
    
    .navigation {
      display: flex;
      justify-content: space-between;
      margin: 30px auto;
      max-width: 800px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .nav-btn {
      background: linear-gradient(45deg, #444, #666);
      color: #ffd700;
      padding: 12px 24px;
      border: 2px solid #ffd700;
      border-radius: 25px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      flex: 1;
      min-width: 150px;
      text-align: center;
    }
    
    .nav-btn:hover {
      background: linear-gradient(45deg, #ffd700, #00ffff);
      color: #000;
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
    }
    
    @media (max-width: 768px) {
      .game-container {
        padding: 10px;
      }
      
      .level-selector {
        grid-template-columns: 1fr;
      }
      
      .hud {
        position: static;
        margin-bottom: 20px;
        max-width: 350px;
        margin-left: auto;
        margin-right: auto;
      }
      
      .quiz-container {
        padding: 20px;
        margin: 10px;
      }
    }
  </style>
</head>
<body>

<div class="stars" id="stars"></div>

<div class="hud">
  <div>üåü Total XP: <span id="totalXP">0</span></div>
  <div>üéØ Current Level: <span id="currentLevel">9-10</span></div>
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <div>üìà Progress: <span id="progressText">0%</span></div>
  <div class="hearts-display" id="heartsDisplay">
    <span class="heart">‚ù§Ô∏è</span>
    <span class="heart">‚ù§Ô∏è</span>
    <span class="heart">‚ù§Ô∏è</span>
    <span class="heart">‚ù§Ô∏è</span>
    <span class="heart">‚ù§Ô∏è</span>
  </div>
  <div>üéØ Accuracy: <span id="accuracyDisplay">100%</span></div>
</div>

<div class="game-container">

<header>
  <h1>üéÆ Code Quest: Levels 9-10</h1>
  <p>Final Projects & Portfolio Development</p>
  
  <div class="level-selector">
    <div class="level-card" onclick="startLevel('projects')" id="projectsCard">
      <h3>üèóÔ∏è Level 9: Final Projects</h3>
      <p>Complete Applications, Portfolio Pieces</p>
      <div>Build impressive projects</div>
    </div>
    <div class="level-card" onclick="startLevel('portfolio')" id="portfolioCard">
      <h3>üéì Level 10: Portfolio & Graduation</h3>
      <p>Showcase, Review, Certification</p>
      <div>Become a certified programmer</div>
    </div>
  </div>
</header>

<!-- Quiz System -->
<div id="quizContainer" class="quiz-container hidden">
  <div class="question-header">
    <div class="question-number" id="questionNumber">Question 1 of 20</div>
    <div class="question-text" id="questionText">What makes a good programming project?</div>
  </div>
  
  <div id="questionContent">
    <!-- Dynamic content will be inserted here -->
  </div>
  
  <div class="question-options" id="questionOptions">
    <!-- Options will be dynamically generated -->
  </div>
  
  <div id="feedbackContainer" class="feedback-container hidden">
    <div id="feedbackText"></div>
    <div id="explanationText" class="explanation"></div>
  </div>
  
  <div style="text-align: center; margin-top: 30px;">
    <button class="button" id="submitButton" onclick="submitAnswer()" disabled>Submit Answer</button>
    <button class="button hidden" id="nextButton" onclick="nextQuestion()">Next Question</button>
  </div>
</div>

<!-- Graduation Ceremony -->
<div id="graduationCeremony" class="graduation-ceremony hidden">
  <h1>üéì CONGRATULATIONS! üéì</h1>
  <h2>You are now a Certified Code Quest Graduate!</h2>
  
  <div class="stats-display">
    <div class="stat-card">
      <div class="stat-value" id="totalScore">0</div>
      <div class="stat-label">Total Score</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="overallAccuracy">0%</div>
      <div class="stat-label">Overall Accuracy</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="totalXPEarned">0</div>
      <div class="stat-label">Total XP</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="finalRank">Novice</div>
      <div class="stat-label">Final Rank</div>
    </div>
  </div>
  
  <div style="margin: 30px 0;">
    <h3>üèÜ Your Programming Journey:</h3>
    <p>‚úÖ Mastered programming fundamentals</p>
    <p>‚úÖ Built interactive applications</p>
    <p>‚úÖ Created visual projects</p>
    <p>‚úÖ Developed problem-solving skills</p>
    <p>‚úÖ Completed portfolio projects</p>
  </div>
  
  <div style="margin: 30px 0;">
    <h3>üöÄ What's Next?</h3>
    <p>Continue your journey with advanced programming topics!</p>
    <button class="button" onclick="goToAdvanced()">üß† Advanced Programming ‚Üí</button>
  </div>
  
  <div style="margin-top: 30px;">
    <button class="button" onclick="goToMenu()">üè† Main Menu</button>
    <button class="button" onclick="shareAchievement()">üì± Share Achievement</button>
  </div>
</div>

<!-- Lesson Complete Screen -->
<div id="lessonComplete" class="lesson-complete hidden">
  <h2>üéâ Level Complete!</h2>
  <div class="stats-display">
    <div class="stat-card">
      <div class="stat-value" id="finalScore">0</div>
      <div class="stat-label">Score</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="finalAccuracy">0%</div>
      <div class="stat-label">Accuracy</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="finalXP">0</div>
      <div class="stat-label">XP Earned</div>
    </div>
    <div class="stat-card">
      <div class="stat-value" id="finalStreak">0</div>
      <div class="stat-label">Streak</div>
    </div>
  </div>
  
  <div id="weakAreasDisplay" class="hidden">
    <h3>üìö Areas to Review:</h3>
    <div id="weakAreasList"></div>
  </div>
  
  <div style="margin-top: 30px;">
    <button class="button" onclick="goToMenu()">üè† Main Menu</button>
    <button class="button" onclick="retryLesson()">üîÑ Retry Lesson</button>
    <button class="button" onclick="checkGraduation()">üéì Check Graduation</button>
  </div>
</div>

</div>

<div class="navigation">
  <a href="levels7-8.html" class="nav-btn">‚Üê Levels 7-8</a>
  <a href="index.html" class="nav-btn">üè† Main Menu</a>
</div>

<script>
// Enhanced Question Bank for Final Projects & Portfolio
const questionBank = {
  projects: [
    {
      type: 'multiple-choice',
      question: 'What makes a good programming project?',
      options: [
        'Complex code that\'s hard to understand',
        'Clear purpose, good documentation, and user-friendly design',
        'Using as many programming languages as possible',
        'Having the most lines of code'
      ],
      correct: 1,
      explanation: 'Good projects solve real problems, are well-documented, and provide value to users.',
      category: 'project-planning',
      difficulty: 'medium'
    },
    {
      type: 'multiple-choice',
      question: 'What should you include in project documentation?',
      options: [
        'Only the final code',
        'Purpose, how to use it, and installation instructions',
        'Personal information about the developer',
        'Criticism of other similar projects'
      ],
      correct: 1,
      explanation: 'Good documentation explains what the project does, how to use it, and how to set it up.',
      category: 'documentation',
      difficulty: 'medium'
    },
    {
      type: 'code-writing',
      question: 'Write a function that validates if an email address contains @ and . symbols:',
      answer: 'def validate_email(email):\n    return "@" in email and "." in email',
      explanation: 'A basic email validation checks for @ and . symbols in the email string.',
      category: 'validation',
      difficulty: 'medium'
    },
    {
      type: 'multiple-choice',
      question: 'What is version control used for in programming?',
      options: [
        'Making code run faster',
        'Tracking changes and collaborating on code',
        'Converting code to different languages',
        'Testing code for bugs'
      ],
      correct: 1,
      explanation: 'Version control systems like Git help track changes and enable collaboration.',
      category: 'version-control',
      difficulty: 'medium'
    },
    {
      type: 'code-writing',
      question: 'Create a simple to-do list manager with add, remove, and display functions:',
      answer: 'todo_list = []\n\ndef add_task(task):\n    todo_list.append(task)\n    print(f"Added: {task}")\n\ndef remove_task(task):\n    if task in todo_list:\n        todo_list.remove(task)\n        print(f"Removed: {task}")\n\ndef display_tasks():\n    for i, task in enumerate(todo_list, 1):\n        print(f"{i}. {task}")',
      explanation: 'A to-do manager needs functions to add, remove, and display tasks using a list.',
      category: 'project-development',
      difficulty: 'hard'
    },
    {
      type: 'multiple-choice',
      question: 'What is the most important aspect of user interface design?',
      options: [
        'Using bright colors',
        'Making it intuitive and easy to use',
        'Adding as many features as possible',
        'Using complex animations'
      ],
      correct: 1,
      explanation: 'Good UI design prioritizes user experience and ease of use over flashy features.',
      category: 'ui-design',
      difficulty: 'medium'
    },
    {
      type: 'debugging',
      question: 'Fix this password strength checker:\ndef check_password(pwd):\n    if len(pwd) > 8:\n        return "Strong"\n    else:\n        return "Weak"',
      answer: 'def check_password(pwd):\n    if len(pwd) >= 8 and any(c.isdigit() for c in pwd) and any(c.isupper() for c in pwd):\n        return "Strong"\n    else:\n        return "Weak"',
      explanation: 'A good password checker should verify length, numbers, and uppercase letters.',
      category: 'security',
      difficulty: 'hard'
    },
    {
      type: 'code-writing',
      question: 'Write a function that calculates the average of a list of numbers:',
      answer: 'def calculate_average(numbers):\n    if len(numbers) == 0:\n        return 0\n    return sum(numbers) / len(numbers)',
      explanation: 'Calculate average by summing all numbers and dividing by the count, handling empty lists.',
      category: 'algorithms',
      difficulty: 'medium'
    },
    {
      type: 'multiple-choice',
      question: 'What is the best way to handle errors in your programs?',
      options: [
        'Ignore them and hope they don\'t happen',
        'Use try-except blocks to catch and handle errors gracefully',
        'Print error messages and continue',
        'Stop the program immediately'
      ],
      correct: 1,
      explanation: 'Try-except blocks allow programs to handle errors gracefully without crashing.',
      category: 'error-handling',
      difficulty: 'medium'
    },
    {
      type: 'code-writing',
      question: 'Create a simple file reader that safely opens and reads a text file:',
      answer: 'def read_file(filename):\n    try:\n        with open(filename, "r") as file:\n            return file.read()\n    except FileNotFoundError:\n        return "File not found"\n    except Exception as e:\n        return f"Error reading file: {e}"',
      explanation: 'Use try-except with file handling to safely read files and handle errors.',
      category: 'file-handling',
      difficulty: 'hard'
    }
  ],
  
  portfolio: [
    {
      type: 'multiple-choice',
      question: 'What should a programming portfolio showcase?',
      options: [
        'Only your most complex projects',
        'A variety of projects demonstrating different skills',
        'Projects you copied from tutorials',
        'Only projects written in one programming language'
      ],
      correct: 1,
      explanation: 'A good portfolio shows range and demonstrates various programming skills and problem-solving abilities.',
      category: 'portfolio-building',
      difficulty: 'medium'
    },
    {
      type: 'multiple-choice',
      question: 'How should you present your code in a portfolio?',
      options: [
        'With clear comments and documentation',
        'Without any explanations to test viewers',
        'Only showing the final output',
        'In the most complex way possible'
      ],
      correct: 0,
      explanation: 'Portfolio code should be well-commented and documented to show your communication skills.',
      category: 'code-presentation',
      difficulty: 'easy'
    },
    {
      type: 'multiple-choice',
      question: 'What is the purpose of a README file in a project?',
      options: [
        'To store backup code',
        'To explain what the project does and how to use it',
        'To list all the bugs in the project',
        'To show off programming knowledge'
      ],
      correct: 1,
      explanation: 'README files provide essential information about the project for users and other developers.',
      category: 'documentation',
      difficulty: 'easy'
    },
    {
      type: 'code-writing',
      question: 'Write a function that generates a simple project summary:',
      answer: 'def project_summary(name, description, technologies, status):\n    summary = f"Project: {name}\\n"\n    summary += f"Description: {description}\\n"\n    summary += f"Technologies: {", ".join(technologies)}\\n"\n    summary += f"Status: {status}\\n"\n    return summary',
      explanation: 'A project summary should include key information formatted clearly for easy reading.',
      category: 'documentation',
      difficulty: 'medium'
    },
    {
      type: 'multiple-choice',
      question: 'What programming concepts have you learned in Code Quest?',
      options: [
        'Only basic syntax',
        'Variables, loops, functions, conditionals, and project development',
        'Only how to print text',
        'Only mathematical operations'
      ],
      correct: 1,
      explanation: 'Code Quest covers fundamental programming concepts essential for software development.',
      category: 'learning-review',
      difficulty: 'easy'
    },
    {
      type: 'multiple-choice',
      question: 'What is the most important skill for a programmer?',
      options: [
        'Memorizing syntax',
        'Problem-solving and logical thinking',
        'Typing speed',
        'Using the latest technology'
      ],
      correct: 1,
      explanation: 'Problem-solving and logical thinking are core skills that apply across all programming languages.',
      category: 'programming-mindset',
      difficulty: 'medium'
    },
    {
      type: 'code-writing',
      question: 'Write a function that counts the frequency of each character in a string:',
      answer: 'def count_characters(text):\n    frequency = {}\n    for char in text:\n        if char in frequency:\n            frequency[char] += 1\n        else:\n            frequency[char] = 1\n    return frequency',
      explanation: 'Use a dictionary to count character frequencies by iterating through the string.',
      category: 'data-structures',
      difficulty: 'hard'
    },
    {
      type: 'multiple-choice',
      question: 'How do you continue learning programming after Code Quest?',
      options: [
        'Stop learning since you know everything',
        'Practice regularly, build projects, and learn new technologies',
        'Only read about programming without coding',
        'Wait for someone to teach you everything'
      ],
      correct: 1,
      explanation: 'Programming is a lifelong learning journey requiring continuous practice and exploration.',
      category: 'continuous-learning',
      difficulty: 'medium'
    },
    {
      type: 'multiple-choice',
      question: 'What makes Code Quest graduates special?',
      options: [
        'They know one programming language perfectly',
        'They have strong fundamentals and problem-solving skills',
        'They can write code without thinking',
        'They never make mistakes'
      ],
      correct: 1,
      explanation: 'Code Quest graduates have solid foundations and the ability to tackle new programming challenges.',
      category: 'graduation',
      difficulty: 'easy'
    },
    {
      type: 'code-writing',
      question: 'Write a final message function that celebrates completing Code Quest:',
      answer: 'def graduation_message(name):\n    message = f"üéì Congratulations {name}! üéì\\n"\n    message += "You have successfully completed Code Quest!\\n"\n    message += "You are now ready to tackle real-world programming challenges.\\n"\n    message += "Keep coding, keep learning, and keep building amazing things!\\n"\n    message += "The world needs more programmers like you! üöÄ"\n    return message',
      explanation: 'A celebration function should be encouraging and acknowledge the achievement of completing the course.',
      category: 'celebration',
      difficulty: 'medium'
    }
  ]
};

// Enhanced Learning System for Final Levels
class FinalProjectLearningSystem {
  constructor() {
    this.currentLevel = null;
    this.currentQuestionIndex = 0;
    this.questions = [];
    this.userAnswers = [];
    this.hearts = 5;
    this.score = 0;
    this.correctAnswers = 0;
    this.weakAreas = new Set();
    this.strongAreas = new Set();
    this.selectedAnswer = null;
    this.hasAnswered = false;
  }

  startLevel(levelKey) {
    this.currentLevel = levelKey;
    this.currentQuestionIndex = 0;
    this.userAnswers = [];
    this.hearts = 5;
    this.score = 0;
    this.correctAnswers = 0;
    this.weakAreas.clear();
    this.strongAreas.clear();
    
    // Get questions for this level
    this.questions = this.selectQuestions(levelKey);
    
    // Show quiz container
    document.getElementById('quizContainer').classList.remove('hidden');
    document.querySelectorAll('.level-card').forEach(card => card.style.display = 'none');
    
    this.displayQuestion();
    this.updateHUD();
  }

  selectQuestions(levelKey) {
    const allQuestions = questionBank[levelKey] || [];
    
    // Comprehensive final assessment
    let selectedQuestions = [];
    
    const easyQuestions = allQuestions.filter(q => q.difficulty === 'easy');
    const mediumQuestions = allQuestions.filter(q => q.difficulty === 'medium');
    const hardQuestions = allQuestions.filter(q => q.difficulty === 'hard');
    
    selectedQuestions.push(...this.shuffleArray(easyQuestions).slice(0, 6));
    selectedQuestions.push(...this.shuffleArray(mediumQuestions).slice(0, 8));
    selectedQuestions.push(...this.shuffleArray(hardQuestions).slice(0, 6));
    
    return this.shuffleArray(selectedQuestions);
  }

  shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }

  displayQuestion() {
    if (this.currentQuestionIndex >= this.questions.length) {
      this.completeLesson();
      return;
    }

    const question = this.questions[this.currentQuestionIndex];
    this.selectedAnswer = null;
    this.hasAnswered = false;

    // Update question header
    document.getElementById('questionNumber').textContent = 
      `Question ${this.currentQuestionIndex + 1} of ${this.questions.length}`;
    document.getElementById('questionText').textContent = question.question;

    // Clear previous content
    document.getElementById('questionContent').innerHTML = '';
    document.getElementById('questionOptions').innerHTML = '';
    document.getElementById('feedbackContainer').classList.add('hidden');
    document.getElementById('submitButton').disabled = true;
    document.getElementById('nextButton').classList.add('hidden');

    // Display question based on type
    this.displayQuestionByType(question);
  }

  displayQuestionByType(question) {
    const optionsContainer = document.getElementById('questionOptions');
    const contentContainer = document.getElementById('questionContent');

    switch (question.type) {
      case 'multiple-choice':
        question.options.forEach((option, index) => {
          const button = document.createElement('button');
          button.className = 'option-button';
          button.textContent = option;
          button.onclick = () => this.selectOption(index);
          optionsContainer.appendChild(button);
        });
        break;

      case 'code-writing':
        const textarea = document.createElement('textarea');
        textarea.className = 'code-input';
        textarea.placeholder = 'Write your Python code here...';
        textarea.oninput = () => {
          this.selectedAnswer = textarea.value.trim();
          document.getElementById('submitButton').disabled = !this.selectedAnswer;
        };
        contentContainer.appendChild(textarea);
        break;

      case 'debugging':
        const buggyCode = document.createElement('div');
        buggyCode.className = 'code-question';
        buggyCode.innerHTML = `<strong>Buggy Code:</strong><br>${question.question.split('\n').slice(1).join('<br>')}`;
        contentContainer.appendChild(buggyCode);

        const fixTextarea = document.createElement('textarea');
        fixTextarea.className = 'code-input';
        fixTextarea.placeholder = 'Write the corrected code here...';
        fixTextarea.oninput = () => {
          this.selectedAnswer = fixTextarea.value.trim();
          document.getElementById('submitButton').disabled = !this.selectedAnswer;
        };
        contentContainer.appendChild(fixTextarea);
        break;
    }
  }

  selectOption(index) {
    if (this.hasAnswered) return;

    // Remove previous selections
    document.querySelectorAll('.option-button').forEach(btn => {
      btn.classList.remove('selected');
    });

    // Select current option
    document.querySelectorAll('.option-button')[index].classList.add('selected');
    this.selectedAnswer = index;
    document.getElementById('submitButton').disabled = false;
  }

  submitAnswer() {
    if (this.hasAnswered || this.selectedAnswer === null) return;

    const question = this.questions[this.currentQuestionIndex];
    let isCorrect = false;

    // Check answer based on question type
    switch (question.type) {
      case 'multiple-choice':
        isCorrect = this.selectedAnswer === question.correct;
        break;
      
      case 'code-writing':
      case 'debugging':
        isCorrect = this.checkCodeAnswer(this.selectedAnswer, question.answer);
        break;
    }

    this.hasAnswered = true;
    this.processAnswer(isCorrect, question);
  }

  checkCodeAnswer(userAnswer, correctAnswer) {
    // Advanced code checking for final projects
    const normalize = (code) => code.toLowerCase().replace(/\s+/g, ' ').trim();
    const userNorm = normalize(userAnswer);
    const correctNorm = normalize(correctAnswer);
    
    // Check for comprehensive understanding
    return userNorm.includes(correctNorm) || 
           correctNorm.includes(userNorm) ||
           this.checkAdvancedSimilarity(userNorm, correctNorm);
  }

  checkAdvancedSimilarity(user, correct) {
    // Check for key programming concepts
    const userWords = user.split(' ');
    const correctWords = correct.split(' ');
    
    let matches = 0;
    correctWords.forEach(word => {
      if (userWords.includes(word)) matches++;
    });
    
    // Also check for alternative valid approaches
    const keyPatterns = ['def ', 'return', 'if ', 'for ', 'while ', 'try:', 'except'];
    const userPatterns = keyPatterns.filter(pattern => user.includes(pattern));
    const correctPatterns = keyPatterns.filter(pattern => correct.includes(pattern));
    
    const patternMatch = userPatterns.length >= correctPatterns.length * 0.8;
    const wordMatch = matches / correctWords.length >= 0.5;
    
    return patternMatch && wordMatch;
  }

  processAnswer(isCorrect, question) {
    // Update statistics
    if (isCorrect) {
      this.correctAnswers++;
      this.score += this.calculatePoints(question.difficulty);
      this.strongAreas.add(question.category);
    } else {
      this.hearts = Math.max(0, this.hearts - 1);
      this.weakAreas.add(question.category);
    }

    // Show feedback
    this.showFeedback(isCorrect, question);
    
    // Update visual feedback on options
    if (question.type === 'multiple-choice') {
      this.updateOptionVisuals(isCorrect, question.correct);
    }

    // Update HUD
    this.updateHUD();

    // Show next button
    document.getElementById('submitButton').classList.add('hidden');
    document.getElementById('nextButton').classList.remove('hidden');

    // Check if out of hearts
    if (this.hearts === 0) {
      setTimeout(() => this.gameOver(), 2000);
    }
  }

  calculatePoints(difficulty) {
    const points = { easy: 30, medium: 50, hard: 75 };
    return points[difficulty] || 30;
  }

  showFeedback(isCorrect, question) {
    const container = document.getElementById('feedbackContainer');
    const feedbackText = document.getElementById('feedbackText');
    const explanationText = document.getElementById('explanationText');

    container.classList.remove('hidden', 'feedback-correct', 'feedback-incorrect');
    
    if (isCorrect) {
      container.classList.add('feedback-correct');
      feedbackText.textContent = '‚úÖ Excellent! You\'re ready for real-world programming!';
    } else {
      container.classList.add('feedback-incorrect');
      feedbackText.textContent = '‚ùå Keep learning! Every expert was once a beginner!';
    }

    explanationText.textContent = question.explanation;
  }

  updateOptionVisuals(isCorrect, correctIndex) {
    const options = document.querySelectorAll('.option-button');
    
    options.forEach((option, index) => {
      option.classList.add('disabled');
      
      if (index === correctIndex) {
        option.classList.add('correct');
      } else if (index === this.selectedAnswer && !isCorrect) {
        option.classList.add('incorrect');
      }
    });
  }

  nextQuestion() {
    this.currentQuestionIndex++;
    this.displayQuestion();
  }

  updateHUD() {
    // Update hearts
    const hearts = document.querySelectorAll('.heart');
    hearts.forEach((heart, index) => {
      heart.classList.toggle('lost', index >= this.hearts);
    });

    // Update accuracy
    const accuracy = this.currentQuestionIndex > 0 ? 
      Math.round((this.correctAnswers / (this.currentQuestionIndex + 1)) * 100) : 100;
    document.getElementById('accuracyDisplay').textContent = accuracy + '%';

    // Update progress
    const progress = ((this.currentQuestionIndex + 1) / this.questions.length) * 100;
    document.getElementById('progressFill').style.width = progress + '%';
    document.getElementById('progressText').textContent = Math.round(progress) + '%';
  }

  completeLesson() {
    // Calculate final stats
    const accuracy = Math.round((this.correctAnswers / this.questions.length) * 100);
    const xpEarned = this.score;
    const streak = this.hearts > 0 ? this.correctAnswers : 0;

    // Update displays
    document.getElementById('finalScore').textContent = this.score;
    document.getElementById('finalAccuracy').textContent = accuracy + '%';
    document.getElementById('finalXP').textContent = xpEarned;
    document.getElementById('finalStreak').textContent = streak;

    // Show weak areas if any
    if (this.weakAreas.size > 0) {
      document.getElementById('weakAreasDisplay').classList.remove('hidden');
      const weakAreasList = document.getElementById('weakAreasList');
      weakAreasList.innerHTML = Array.from(this.weakAreas)
        .map(area => `<span style="background: rgba(255,68,68,0.2); padding: 5px 10px; border-radius: 15px; margin: 5px; display: inline-block;">${area}</span>`)
        .join('');
    }

    // Update global progress if available
    if (window.progressTracker) {
      window.progressTracker.updateLevelProgress(
        `levels910`, 
        this.correctAnswers, 
        this.questions.length, 
        xpEarned
      );
    }

    // Show completion screen
    document.getElementById('quizContainer').classList.add('hidden');
    document.getElementById('lessonComplete').classList.remove('hidden');
  }

  gameOver() {
    alert('üíî Out of hearts! Final projects are challenging - you\'re almost there!');
    this.retryLesson();
  }

  retryLesson() {
    document.getElementById('lessonComplete').classList.add('hidden');
    document.getElementById('graduationCeremony').classList.add('hidden');
    document.querySelectorAll('.level-card').forEach(card => card.style.display = 'block');
    document.getElementById('quizContainer').classList.add('hidden');
  }
}

// Initialize the learning system
const learningSystem = new FinalProjectLearningSystem();

// Global functions
function startLevel(levelKey) {
  learningSystem.startLevel(levelKey);
}

function submitAnswer() {
  learningSystem.submitAnswer();
}

function nextQuestion() {
  learningSystem.nextQuestion();
}

function goToMenu() {
  window.location.href = 'index.html';
}

function retryLesson() {
  learningSystem.retryLesson();
}

function checkGraduation() {
  // Check if user has completed all foundation levels
  if (window.progressTracker) {
    const allLevels = ['levels12', 'levels34', 'levels56', 'levels78', 'levels910'];
    const allCompleted = allLevels.every(level => 
      window.progressTracker.userProgress[level]?.completed
    );
    
    if (allCompleted) {
      showGraduationCeremony();
    } else {
      alert('Complete all foundation levels to graduate from Code Quest!');
    }
  } else {
    showGraduationCeremony(); // Fallback if no progress tracker
  }
}

function showGraduationCeremony() {
  // Calculate overall stats
  let totalScore = 0;
  let totalAccuracy = 0;
  let totalXP = 0;
  
  if (window.progressTracker) {
    totalXP = window.progressTracker.userStats.totalXP || 0;
    totalAccuracy = window.progressTracker.userStats.totalQuestions > 0 ? 
      Math.round((window.progressTracker.userStats.correctAnswers / window.progressTracker.userStats.totalQuestions) * 100) : 0;
    
    // Calculate total score from all levels
    Object.values(window.progressTracker.userProgress).forEach(level => {
      if (level.xp) totalScore += level.xp;
    });
  }
  
  // Determine rank based on performance
  let rank = 'Novice';
  if (totalXP >= 2000 && totalAccuracy >= 90) rank = 'Master';
  else if (totalXP >= 1500 && totalAccuracy >= 80) rank = 'Expert';
  else if (totalXP >= 1000 && totalAccuracy >= 70) rank = 'Advanced';
  else if (totalXP >= 500 && totalAccuracy >= 60) rank = 'Intermediate';
  
  // Update graduation display
  document.getElementById('totalScore').textContent = totalScore;
  document.getElementById('overallAccuracy').textContent = totalAccuracy + '%';
  document.getElementById('totalXPEarned').textContent = totalXP;
  document.getElementById('finalRank').textContent = rank;
  
  // Show graduation ceremony
  document.getElementById('lessonComplete').classList.add('hidden');
  document.getElementById('graduationCeremony').classList.remove('hidden');
}

function goToAdvanced() {
  window.location.href = 'index-advanced.html';
}

function shareAchievement() {
  const message = "üéì I just graduated from Code Quest! I'm now a certified programmer ready to build amazing things! üöÄ #CodeQuest #Programming #Achievement";
  
  if (navigator.share) {
    navigator.share({
      title: 'Code Quest Graduate!',
      text: message,
      url: window.location.origin
    });
  } else {
    // Fallback for browsers without Web Share API
    navigator.clipboard.writeText(message).then(() => {
      alert('Achievement message copied to clipboard! Share it on your favorite social media platform!');
    });
  }
}

// Initialize stars animation
function createStars() {
  const starsContainer = document.getElementById('stars');
  for (let i = 0; i < 100; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + '%';
    star.style.top = Math.random() * 100 + '%';
    star.style.width = star.style.height = Math.random() * 3 + 1 + 'px';
    star.style.animationDelay = Math.random() * 2 + 's';
    starsContainer.appendChild(star);
  }
}

// Initialize on page load
window.onload = function() {
  createStars();
  
  // Load user progress if available
  if (window.progressTracker) {
    // Auto-login if session exists
    const session = window.progressTracker.getLoginSession();
    if (session) {
      window.progressTracker.login(true);
    }
  }
};
</script>
</body>
</html>